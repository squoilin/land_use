# ğŸ‡§ğŸ‡ª Belgium Land Use Division Framework

A Python framework for dividing Belgium into regions with pre-determined areas, ensuring computational efficiency and generating contiguous, visually appealing regions similar to administrative divisions.

## ğŸ¯ **Project Overview**

This project implements an advanced geospatial algorithm that:
- **Divides Belgium** into 13 land use categories with specific target areas
- **Ensures contiguity** - each category should form a single connected region
- **Maintains area accuracy** within Â±3% tolerance
- **Runs efficiently** with guaranteed completion under 2 minutes
- **Provides visual results** similar to administrative boundary maps

## ğŸ“Š **Target Land Use Categories**

| Category                               | Area (kmÂ²) | % of Total |
| -------------------------------------- | ---------- | ---------- |
| Agricultural land (others)             | 12,803     | 41.7%      |
| Forest                                 | 6,138      | 20.0%      |
| Other natural/semi-natural/rest        | 4,271      | 13.9%      |
| Roads and rail infrastructure          | 3,553      | 11.6%      |
| Built-up (residential, industry, etc.) | 2,762      | 9.0%       |
| Energy crops                           | 700        | 2.3%       |
| Paths/tracks                           | 250        | 0.8%       |
| Water bodies (inland)                  | 143        | 0.47%      |
| Golf courses                           | 45         | 0.15%      |
| Football pitches                       | 30         | 0.10%      |
| Sport and leisure facilities (others)  | 15         | 0.05%      |
| Wind turbines (footprint)              | 14         | 0.05%      |
| Ground-mounted PV                      | 13         | 0.04%      |

**Total Area: 30,737 kmÂ²**

## ğŸš€ **Quick Start**

### Prerequisites
- Python 3.8+
- Conda environment with geospatial libraries

### Installation & Setup

1. **Clone the repository:**
   ```bash
   git clone git@github.com:squoilin/land_use.git
   cd land_use
   ```

2. **Download required geodata files:**
   
   Create a `geodata/` folder and download the following large files:
   
   ```bash
   mkdir geodata
   cd geodata
   ```
   
   **Required files (download separately):**
   - `prepared_units.geojson` (207 MB) - Pre-processed Belgian statistical units
   - `sh_statbel_statistical_sectors_31370_20240101.geojson.zip` (43 MB) - Source data from Statbel
   - Extract the zip: `unzip sh_statbel_statistical_sectors_31370_20240101.geojson.zip`
   
   **ğŸ”— Data Sources:**
   - **Statbel Statistical Sectors**: Download from [Statistics Belgium Open Data](https://statbel.fgov.be/en/open-data)
   - **Prepared Units**: Generated by pre-processing the statistical sectors (see `legacy/` for preparation scripts)

3. **Create conda environment:**
   ```bash
   conda create -n belgium_land_use_env python=3.9 geopandas shapely matplotlib numpy pandas
   conda activate belgium_land_use_env
   ```

4. **Run the framework:**
   ```bash
   python contiguous_land_divider.py
   ```

### Expected Runtime
- **â° Duration:** ~70-95 seconds
- **ğŸ›¡ï¸ Timeout Protection:** 2 minutes maximum
- **ğŸ’¾ Memory:** Handles 19,795 statistical units efficiently

## ğŸ“ **File Structure**

### Essential Files (in Git)
```
land_use/
â”œâ”€â”€ contiguous_land_divider.py    # Main algorithm script
â”œâ”€â”€ belgium.geojson               # Belgium boundary data (16KB)
â”œâ”€â”€ belgium_boundary.geojson      # Alternative boundary data (16KB)
â”œâ”€â”€ germany.jpeg                  # Reference example for visual quality (53KB)
â”œâ”€â”€ strategy.md                   # Original strategy documentation
â”œâ”€â”€ README.md                     # This file
â”œâ”€â”€ .gitignore                    # Git ignore rules
â”œâ”€â”€ geodata/                      # Large geospatial files (git-ignored)
â”‚   â”œâ”€â”€ prepared_units.geojson    # Pre-processed units (207MB) âš ï¸ REQUIRED
â”‚   â”œâ”€â”€ sh_statbel_*.geojson.zip  # Source data (43MB) âš ï¸ REQUIRED  
â”‚   â””â”€â”€ sh_statbel_*/             # Extracted source data (194MB)
â””â”€â”€ legacy/                       # Historical scripts and outputs
```

### ğŸ“¦ **Geodata Folder Requirements**

The `geodata/` folder contains large files (>10MB) that are not stored in Git due to size constraints. 

**âš ï¸ REQUIRED FILES** - Download these separately:

1. **`prepared_units.geojson`** (207 MB)
   - Pre-processed Belgian statistical sectors in EPSG:3035 projection
   - Contains 19,795 units with area calculations and unique IDs
   - Essential for the main algorithm execution

2. **`sh_statbel_statistical_sectors_31370_20240101.geojson.zip`** (43 MB)
   - Original source data from Statistics Belgium (Statbel)
   - Contains official administrative boundaries
   - Extract this to get the full source dataset

3. **`sh_statbel_statistical_sectors_31370_20240101.geojson/`** (extracted, 194 MB)
   - Extracted source data directory
   - Contains the main GeoJSON file and documentation
   - Used for data verification and alternative processing

**ğŸ”„ Alternative Setup:**
If you don't have the prepared data, you can generate `prepared_units.geojson` using the scripts in `legacy/` folder.

### Legacy Folder
Contains previous iterations, experimental scripts, and generated outputs:
- Previous algorithm versions (`land_divider.py`, `improved_land_divider.py`, etc.)
- Generated visualizations and summary reports
- Intermediate data files and experimental results

## ğŸ”§ **Algorithm Features**

### **âœ… Performance Optimizations**
- **Spatial Indexing:** O(N log N) adjacency calculation using STRtree
- **Timeout Protection:** 2-minute hard limit with graceful degradation
- **Memory Efficient:** Handles 19,795 units smoothly
- **Progress Tracking:** Real-time updates and ETA calculations

### **âœ… Region Growing Strategy**
- **Smart Seed Selection:** Connectivity and area-based scoring
- **Controlled Growth:** Simultaneous expansion with area limits
- **Contiguity Enforcement:** Ensures connected regions
- **Deficit-Based Distribution:** Proportional allocation of remaining units

### **âœ… Strict Validation**
- **Contiguity Check:** All categories must form single polygons
- **Area Accuracy:** All categories must be within Â±3% tolerance
- **Coverage Verification:** 100% territory allocation
- **Component Analysis:** Detailed fragmentation reporting

## ğŸ“ˆ **Current Performance**

### **Runtime Performance** âœ…
- **Actual Runtime:** 68-95 seconds
- **Timeout Limit:** 120 seconds
- **Success Rate:** 100% completion
- **Processing Rate:** ~300-500 units/second

### **Quality Metrics** ğŸ”„ *In Progress*
- **Contiguous Categories:** 5/13 (38%) - *Target: 100%*
- **Area Accuracy:** 1/13 (8%) - *Target: 100%*
- **Visual Quality:** High - Similar to administrative boundaries
- **Coverage:** 100% of Belgium territory

## ğŸ› ï¸ **Technical Implementation**

### **Dependencies**
```python
import geopandas as gpd
from shapely.geometry import Polygon, Point
from shapely.strtree import STRtree
import matplotlib.pyplot as plt
import numpy as np
import signal  # For timeout protection
```

### **Key Algorithm Phases**
1. **Adjacency Calculation** (~40s) - Spatial relationship mapping
2. **Seed Selection** (~2s) - Optimal starting points for each category  
3. **Controlled Growth** (~5s) - Simultaneous region expansion
4. **Geometry Creation** (~10s) - Final region polygon generation
5. **Validation & Export** (~5s) - Quality checks and output generation

### **Equal-Area Projection**
Uses `EPSG:3035` (LAEA Europe) for accurate area calculations and measurements.

## ğŸ“Š **Output Files**

When the algorithm completes, it generates:
- **`belgium_contiguous_regions_fast.geojson`** - Region boundaries (11MB)
- **`belgium_contiguous_regions_fast.png`** - Visualization map (870KB)
- **Console Output** - Detailed progress and validation results

## ğŸš§ **Current Status & Next Steps**

### **âœ… Completed**
- Fast, reliable algorithm with timeout protection
- Comprehensive progress tracking and validation
- Clean project structure and documentation
- High-quality visual output generation

### **ğŸ”„ In Progress**
- **Improving contiguity:** Working to achieve 100% single-polygon regions
- **Area accuracy optimization:** Fine-tuning to meet strict Â±3% tolerance
- **Seed selection enhancement:** Better initial placement strategies

### **ğŸ¯ Goals**
- All 13 categories as single contiguous polygons
- All categories within Â±3% area tolerance
- Sub-60 second runtime
- Publication-ready visualizations

## ğŸ“š **Documentation**

- **`strategy.md`** - Original problem definition and algorithmic approaches
- **`legacy/`** - Historical development documentation and results
- **Console Output** - Real-time algorithm progress and diagnostics

## ğŸ¤ **Contributing**

This is an active research project. Key areas for contribution:
1. **Algorithm optimization** for better contiguity
2. **Area distribution improvements** for accuracy
3. **Visualization enhancements** for publication quality
4. **Performance optimization** for larger datasets

## ğŸ“§ **Contact**

For questions about the framework or collaboration opportunities, please open an issue in this repository.

---

**ğŸ‰ The Belgium Land Use Division Framework - Turning complex geospatial problems into efficient, visual solutions!** ğŸ‡§ğŸ‡ªâœ¨ 